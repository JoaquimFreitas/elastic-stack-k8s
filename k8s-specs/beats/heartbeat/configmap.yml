apiVersion: v1
kind: ConfigMap
metadata:
  name: heartbeat-config
  namespace: pets
  labels:
    app: heartbeat
data:
  heartbeat.yml: |-
    heartbeat.monitors:
    - type: http
      schedule: '@every 5s'
      urls:
        - http://elasticsearch:9200/_cluster/health
        - http://kibana:5601/status
        - http://logstash:9600/?pretty

    - type: icmp
      schedule: '@every 5s'
      hosts:
        - elasticsearch
        - kibana
        - logstash

    processors:
    - add_cloud_metadata:
    - add_host_metadata:
        netinfo.enabled: false
        cache.ttl: 5m

    output.elasticsearch:
      hosts: ['http://elasticsearch:9200']

    setup:
      kibana:
        host: "http://kibana:5601"
      dashboards:
        enabled: true
        index: "heartbeat-*"
        retry:
          enabled: true
          interval: 30
      template:
        enabled: true

    xpack.monitoring.enabled: true